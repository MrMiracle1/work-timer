<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工作摸鱼神器</title>
    <link rel="stylesheet" href="styles.css">
    <script src="prompts.js"></script>
    <script src="ai-module.js"></script>
    <script src="command-module.js"></script>
</head>
<body>
    <!-- 侧边栏抽屉 -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>菜单</h2>
            <button class="close-sidebar" id="close-sidebar">✕</button>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-tab="countdown">
                <span class="nav-icon">⏰</span>
                <span class="nav-text">倒计时</span>
            </a>
            <a href="#" class="nav-item" data-tab="calendar">
                <span class="nav-icon">📅</span>
                <span class="nav-text">日历</span>
            </a>
            <a href="#" class="nav-item" data-tab="rmrb">
                <span class="nav-icon">📰</span>
                <span class="nav-text">人民日报</span>
            </a>
            <a href="#" class="nav-item" data-tab="surf">
                <span class="nav-icon">🏄</span>
                <span class="nav-text">网上冲浪</span>
            </a>
            <a href="#" class="nav-item" data-tab="settings">
                <span class="nav-icon">⚙️</span>
                <span class="nav-text">设置</span>
            </a>
        </nav>
    </div>
    
    <!-- 遗罩层 -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
        
    <!-- AI助手悬浮窗（右侧） -->
    <div class="ai-assistant-float" id="ai-assistant-float">
        <div class="ai-float-toggle" id="ai-float-toggle">
            <span class="ai-icon">🤖</span>
        </div>
        <div class="ai-float-panel" id="ai-float-panel">
            <div class="ai-float-header">
                <span>🤖 AI 助手</span>
                <button class="ai-float-close" id="ai-float-close">✕</button>
            </div>
            <div class="ai-float-messages" id="ai-float-messages">
                <div class="ai-message system">你好！我是你的日常助手，可以帮你快速执行操作，也可以随意聊天。</div>
            </div>
            <div class="ai-float-status" id="ai-float-status" style="display: none;"></div>
            <div class="ai-float-input">
                <input type="text" id="ai-float-input" placeholder="说点什么...">
                <button id="ai-float-send">发送</button>
            </div>
        </div>
    </div>
    
    <!-- 菜单按钮（页面左上角） -->
    <button class="menu-toggle-fixed" id="menu-toggle">☰</button>
    
    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-left">
                    <h1>工作机器打鸣器</h1>
                    <p class="subtitle">距离下一个快乐时刻还有...</p>
                </div>
                <!-- 今日留言条（嵌入header） -->
                <div id="daily-note-banner" class="daily-note-banner-header" style="display: none;">
                    <span class="note-banner-content" id="daily-note-banner-content"></span>
                </div>
                <div class="header-right">
                    <button id="clock-in-btn" class="clock-in-btn-header">👋 上班打卡</button>
                    <div class="current-time-container">当前时间: <div id="current-time" class="current-time"></div></div>
                </div>
            </div>
        </header>
        
        <!-- 番茄钟模态窗口 -->
        <div id="pomodoro-modal" class="modal">
            <div class="modal-content pomodoro-modal-content">
                <div class="modal-header">
                    <h2>🍅 番茄钟</h2>
                    <button class="close-modal" id="close-pomodoro">✕</button>
                </div>
                <div class="pomodoro-body">
                    <div class="pomodoro-timer-display" id="pomodoro-timer">25:00</div>
                    <div class="pomodoro-controls" id="pomodoro-setup">
                        <h3>设置专注时长</h3>
                        <div class="quick-select">
                            <button class="quick-btn" data-minutes="15">15分钟</button>
                            <button class="quick-btn" data-minutes="30">30分钟</button>
                            <button class="quick-btn" data-minutes="45">45分钟</button>
                            <button class="quick-btn" data-minutes="60">60分钟</button>
                        </div>
                        <div class="custom-time-input">
                            <label for="custom-minutes">自定义时长（分钟）:</label>
                            <input type="number" id="custom-minutes" min="1" max="120" value="25">
                        </div>
                        <button id="start-pomodoro" class="primary-btn">开始专注</button>
                    </div>
                    <div class="pomodoro-controls" id="pomodoro-running" style="display: none;">
                        <button id="cancel-pomodoro" class="cancel-btn">取消专注</button>
                    </div>
                    <div class="pomodoro-controls" id="pomodoro-complete" style="display: none;">
                        <div class="complete-message" id="complete-message"></div>
                        <button id="restart-pomodoro" class="primary-btn">再来一次</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 打卡问候弹窗 -->
        <div id="greeting-modal" class="modal">
            <div class="modal-content greeting-modal-content">
                <button class="close-modal" id="close-greeting-modal">✕</button>
                <div class="greeting-message" id="greeting-message"></div>
                <div class="greeting-error" id="greeting-error"></div>
                
                <!-- 上班打卡时显示的留言区域 -->
                <div id="clock-in-note-section" style="display: none;">
                    <div class="note-input-section">
                        <label for="daily-note">今日想对自己说的话：</label>
                        <textarea id="daily-note" placeholder="记录今天的目标、期待或者想对自己说的话..."></textarea>
                        <div class="note-actions">
                            <button id="generate-ai-note" class="ai-generate-btn">🤖 AI生成鼓励</button>
                            <button id="save-daily-note" class="save-note-btn">✔️ 保存留言</button>
                        </div>
                    </div>
                </div>
                
                <!-- 下班打卡时显示的统计报告 -->
                <div id="clock-out-summary" style="display: none;">
                    <div class="summary-content" id="summary-content"></div>
                </div>
                
                <div class="greeting-countdown" id="greeting-countdown"></div>
            </div>
        </div>
        
        <!-- 时间轴模态窗口 -->
        <div id="timeline-modal" class="modal">
            <div class="modal-content timeline-modal-content">
                <div class="modal-header">
                    <h2>📅 今日时间轴</h2>
                    <button class="close-modal" id="close-timeline">✕</button>
                </div>
                <div class="timeline-body">
                    <div id="timeline-date" class="timeline-date"></div>
                    <div id="timeline-list" class="timeline-list">
                        <!-- 时间轴事件将通过 JS 动态生成 -->
                    </div>
                    <div id="timeline-empty" class="timeline-empty" style="display: none;">
                        <div class="empty-icon">📆</div>
                        <div>今日还没有任何记录</div>
                        <div class="empty-tip">上班打卡、点击卡片、番茄钟等操作都会被记录在时间轴中</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="setup-modal" class="modal">
            <div class="modal-content">
                <h2>首次设置</h2>
                <p>请设置您的上下班时间和发薪日</p>
                <div class="form-group">
                    <label for="work-start-time">上班时间:</label>
                    <input type="time" id="work-start-time" value="08:30">
                </div>
                <div class="form-group">
                    <label for="lunch-start-time">午休开始时间:</label>
                    <input type="time" id="lunch-start-time" value="11:30">
                </div>
                <div class="form-group">
                    <label for="lunch-end-time">午休结束时间:</label>
                    <input type="time" id="lunch-end-time" value="14:00">
                </div>
                <div class="form-group">
                    <label for="work-end-time">下班时间:</label>
                    <input type="time" id="work-end-time" value="17:30">
                </div>
                <div class="form-group">
                    <label for="salary-type">发薪日类型:</label>
                    <select id="salary-type">
                        <option value="fixed">固定日期</option>
                        <option value="last">每月最后一天</option>
                    </select>
                </div>
                <div class="form-group" id="salary-fixed-group">
                    <label for="salary-day">每月发薪日:</label>
                    <input type="number" id="salary-day" min="1" max="31" value="15">
                </div>
                <button id="save-work-time">保存</button>
            </div>
        </div>
        
        <main>
            
            <div id="countdown" class="tab-content active">
                <div class="main-countdown">
                    <div class="countdown-row">
                        <div class="countdown-card main-card" id="workday-end-card">
                            <h3>下班倒计时</h3>
                            <div class="countdown-time" id="time-workday-end">--:--:--</div>
                            <div class="countdown-date" id="date-workday-end">--</div>
                        </div>
                        
                        <div class="countdown-card main-card" id="weekend-card">
                            <h3>本周剩余工作时间</h3>
                            <div class="countdown-time" id="time-weekend">--小时--分钟</div>
                            <div class="countdown-date" id="date-weekend">--</div>
                        </div>
                    </div>
                    
                    <div class="countdown-row">
                        <div class="countdown-card main-card" id="salary-day-card">
                            <h3>发薪倒计时</h3>
                            <div class="countdown-time" id="time-salary-day">--天</div>
                            <div class="countdown-date" id="date-salary-day">--</div>
                        </div>
                        
                        <div class="countdown-card main-card" id="next-holiday-card">
                            <h3>期待时间</h3>
                            <div class="countdown-time" id="time-next-holiday">--</div>
                            <div class="countdown-date" id="date-next-holiday">--</div>
                        </div>
                    </div>
                </div>
                
                <!-- 存钱罐进度条 -->
                <div class="progress-section" id="progress-section-card">
                    <h2>工资进度</h2>
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="progress-text" id="progress-text"></div>
                    </div>
                </div>
                
                <!-- 快捷功能入口 -->
                <div class="quick-actions">
                    <button id="open-pomodoro" class="quick-action-btn">
                        <span class="quick-icon">🍅</span>
                        <span>番茄钟</span>
                    </button>
                    <button id="open-timeline" class="quick-action-btn">
                        <span class="quick-icon">📅</span>
                        <span>时间轴</span>
                    </button>
                </div>
                
                <h2>其他假期</h2>
                <div class="other-holidays">
                    <!-- 其他假期倒计时将通过JS动态生成 -->
                </div>
            </div>
            
            <div id="calendar" class="tab-content">
                <div class="calendar-page-layout">
                    <!-- 左侧：日历 -->
                    <div class="calendar-left">
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <button id="prev-month">◀</button>
                                <h2 id="current-month">2024年5月</h2>
                                <button id="next-month">▶</button>
                            </div>
                            <div class="weekdays">
                                <div>日</div>
                                <div>一</div>
                                <div>二</div>
                                <div>三</div>
                                <div>四</div>
                                <div>五</div>
                                <div>六</div>
                            </div>
                            <div class="calendar-days">
                                <!-- 日历天数将通过JS动态生成 -->
                            </div>
                            <div class="calendar-legend">
                                <div><span class="legend-color workday"></span> 工作日</div>
                                <div><span class="legend-color weekend"></span> 周末</div>
                                <div><span class="legend-color workday-off"></span> 公休假期</div>
                                <div><span class="legend-color weekend-work"></span> 串休上班日</div>
                                <div><span class="legend-color custom-holiday"></span> 自定义假期</div>
                                <div><span class="legend-color salary-day"></span> 发薪日</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 右侧：添加事件和事件列表 -->
                    <div class="calendar-right">
                        <!-- 添加事件卡片 -->
                        <div class="event-add-card">
                            <h3>📝 添加事件</h3>
                            <div class="event-form">
                                <input type="text" id="event-title" class="event-input" placeholder="事件标题">
                                <select id="event-type" class="event-select">
                                    <option value="work">💼 工作</option>
                                    <option value="personal">👤 个人</option>
                                    <option value="meeting">🤝 会议</option>
                                    <option value="birthday">🎂 生日</option>
                                    <option value="holiday">🎉 节日</option>
                                    <option value="other">📌 其他</option>
                                </select>
                                <input type="time" id="event-time" class="event-input" placeholder="时间（可选）">
                                <textarea id="event-note" class="event-textarea" placeholder="备注（可选）" rows="2"></textarea>
                                <button id="add-calendar-event" class="event-add-btn">添加事件</button>
                            </div>
                        </div>
                        
                        <!-- 今日事件列表 -->
                        <div class="today-events-card">
                            <h3>📅 <span id="selected-date-display">今日</span>事件</h3>
                            <div id="today-events-list" class="events-list">
                                <!-- 事件列表将通过JS动态生成 -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="rmrb" class="tab-content">
                <iframe src="rmrb/index.html" class="rmrb-iframe"></iframe>
            </div>
            
            <div id="surf" class="tab-content">
                <iframe src="surf/index.html" class="surf-iframe"></iframe>
            </div>
            
            <div id="settings" class="tab-content">
                <div class="settings-section">
                    <h2>用户设置</h2>
                    <div class="form-group">
                        <label for="settings-work-start-time">上班时间:</label>
                        <input type="time" id="settings-work-start-time">
                    </div>
                    <div class="form-group">
                        <label for="settings-lunch-start-time">午休开始时间:</label>
                        <input type="time" id="settings-lunch-start-time">
                    </div>
                    <div class="form-group">
                        <label for="settings-lunch-end-time">午休结束时间:</label>
                        <input type="time" id="settings-lunch-end-time">
                    </div>
                    <div class="form-group">
                        <label for="settings-work-end-time">下班时间:</label>
                        <input type="time" id="settings-work-end-time">
                    </div>
                    <div class="form-group">
                        <label for="settings-salary-type">发薪日类型:</label>
                        <select id="settings-salary-type">
                            <option value="fixed">固定日期</option>
                            <option value="last">每月最后一天</option>
                        </select>
                    </div>
                    <div class="form-group" id="settings-salary-fixed-group">
                        <label for="settings-salary-day">每月发薪日:</label>
                        <input type="number" id="settings-salary-day" min="1" max="31" value="1">
                    </div>
                    <button id="update-work-time">更新</button>
                </div>

                <div class="settings-section">
                    <h2>节假日设置</h2>
                    <div class="form-group">
                        <label for="official-holidays-json">法定节假日JSON（{"YYYY-M-D":"节日名"}）:</label>
                        <textarea id="official-holidays-json" rows="6" style="width:100%"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="official-weekendwork-json">周末上班JSON（{"YYYY-M-D":true}）:</label>
                        <textarea id="official-weekendwork-json" rows="4" style="width:100%"></textarea>
                    </div>
                    <div class="form-group">
                        <button id="import-official-holidays">导入节假日</button>
                        <button id="reset-official-holidays" style="margin-left:10px">重置为默认</button>
                        <button id="export-official-holidays" style="margin-left:10px">导出配置JSON</button>
                    </div>
                </div>

                <div class="settings-section developer-settings">
                    <h2>开发者设置</h2>
                    <div class="form-group">
                        <label for="developer-mode">开启自定义时间:</label>
                        <input type="checkbox" id="developer-mode">
                    </div>
                    <div class="form-group" id="custom-time-container" style="display: none;">
                        <label for="custom-time">自定义时间:</label>
                        <input type="datetime-local" id="custom-time">
                    </div>
                    <div class="form-group">
                        <button id="clear-cache">删除缓存（重置为默认设置）</button>
                    </div>
                </div>
                
                <div class="settings-section ai-settings">
                    <h2>AI功能设置</h2>
                    <div class="form-group">
                        <label for="ai-api-key">DeepSeek API 密钥:</label>
                        <input type="password" id="ai-api-key" placeholder="输入你的 DeepSeek API Key">
                        <button id="toggle-api-key" style="margin-left: 10px;">👁️</button>
                    </div>
                    <div class="form-group">
                        <button id="save-api-key">保存 API 密钥</button>
                        <button id="test-api-key" style="margin-left: 10px;">测试连接</button>
                    </div>
                    <div class="api-status" id="api-status"></div>
                </div>
                
                <div class="custom-events">
                <h2>自定义事件</h2>
                <div class="form-group">
                    <input type="text" id="event-name" placeholder="事件名称">
                    <input type="datetime-local" id="event-time">
                    <select id="event-repeat">
                        <option value="none">不重复</option>
                        <option value="daily">每天</option>
                        <option value="weekly">每周</option>
                        <option value="monthly">每月</option>
                        <option value="yearly">每年</option>
                    </select>
                    <button id="add-event">添加</button>
                </div>
                <div class="custom-events-list">
                    <!-- 自定义事件列表将通过JS动态生成 -->
                </div>
            </div>
        </main>
        
        <footer>
            <div class="footer-tabs">
                <div class="footer-tab active" data-tab="countdown">倒计时</div>
                <div class="footer-tab" data-tab="calendar">日历</div>
                <div class="footer-tab" data-tab="rmrb">人民日报</div>
                <div class="footer-tab" data-tab="surf">网上冲浪</div>
                <div class="footer-tab" data-tab="settings">设置</div>
            </div>
            <p>数据保存在本地浏览器中 | 摸鱼愉快 😎</p>
            <div class="documentation-links">
                <a href="docs/viewer.html?doc=product_document.md">产品文档</a> | 
                <a href="docs/viewer.html?doc=prompt_document.md">Prompt指令文档</a> | 
                <a href="docs/viewer.html?doc=development_log.md">开发日志</a> | 
                <a href="docs/viewer.html?doc=user_manual.md">用户手册</a> | 
                <a href="https://mrmiracle1.github.io/xinliu_diary/" target="_blank">心流日记</a>
            </div>
        </footer>
    </div>
    
    <script src="script.js"></script>
    </body>
</html>
