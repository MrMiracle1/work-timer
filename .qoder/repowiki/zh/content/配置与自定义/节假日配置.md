# 节假日配置

<cite>
**本文档引用文件**   
- [holidays.json](file://config/holidays.json)
- [script.js](file://script.js)
- [index.html](file://index.html)
</cite>

## 目录
1. [配置文件结构](#配置文件结构)
2. [节假日判断逻辑](#节假日判断逻辑)
3. [配置管理与持久化](#配置管理与持久化)
4. [用户界面操作](#用户界面操作)
5. [配置错误处理](#配置错误处理)

## 配置文件结构

`config/holidays.json` 文件定义了法定节假日和调休上班日的配置。该文件包含两个主要字段：`officialHolidays` 和 `weekendWorkdays`。

`officialHolidays` 字段用于定义法定节假日，其值为一个对象，键为日期字符串（格式为 YYYY-M-D），值为节日名称。例如，"2026-1-1": "元旦" 表示2026年1月1日为元旦假期。

`weekendWorkdays` 字段用于标记调休上班日，其值为一个对象，键为日期字符串（格式为 YYYY-M-D），值为布尔值 true。例如，"2026-1-4": true 表示2026年1月4日为调休上班日。

**Section sources**
- [holidays.json](file://config/holidays.json#L1-L45)

## 节假日判断逻辑

系统通过 `script.js` 中的 `isHoliday` 和 `isWeekendWork` 函数实现节假日判断逻辑。`isHoliday` 函数检查给定日期是否为公休假期，通过查询 `workdaysOff` 对象来判断。`isWeekendWork` 函数检查给定日期是否为串休上班日，通过查询 `weekendsWork` 对象来判断。

这些判断逻辑在日历渲染和事件计算中被广泛使用。例如，在日历渲染时，系统会检查每个日期是否为周末、公休假期或串休上班日，并相应地应用不同的CSS类。对于工作日，如果该日是公休假期，则添加 `workday-off` 类；对于周末，如果该日是串休上班日，则添加 `weekend-work` 类。

**Section sources**
- [script.js](file://script.js#L69-L84)
- [script.js](file://script.js#L2530-L2555)

## 配置管理与持久化

系统通过 `localStorage` 实现节假日配置的持久化管理。在应用初始化时，系统会从 `config/holidays.json` 文件加载默认的节假日配置，并将其存储到 `localStorage` 中的 `officialHolidays` 和 `officialWeekendWorkdays` 键下。

`mergeOfficialHolidaysIntoCalendar` 函数负责将存储在 `localStorage` 中的官方节假日和串休上班日配置合并到当前日历的 `workdaysOff` 和 `weekendsWork` 对象中。该函数会遍历 `officialHolidays` 和 `officialWeekendWorkdays` 对象的键，将符合条件的日期添加到相应的对象中，并最终将更新后的对象保存回 `localStorage`。

**Section sources**
- [script.js](file://script.js#L1274-L1322)
- [script.js](file://script.js#L7-L8)

## 用户界面操作

用户可以通过设置页面的文本区域直接编辑节假日配置。页面提供了两个文本区域：一个用于编辑法定节假日JSON，另一个用于编辑周末上班JSON。用户可以点击“导入节假日”按钮将编辑的配置应用到系统中，也可以点击“重置为默认”按钮恢复到从 `config/holidays.json` 加载的默认配置。

这些操作通过事件监听器实现。当用户点击“导入节假日”按钮时，系统会尝试解析文本区域中的JSON内容，并将其保存到 `localStorage` 中的 `officialHolidays` 键下。如果解析失败，系统会显示错误提示。当用户点击“重置为默认”按钮时，系统会将 `defaultOfficialHolidays` 对象（从 `config/holidays.json` 加载）保存回 `localStorage`。

**Section sources**
- [index.html](file://index.html#L397-L412)
- [script.js](file://script.js#L2643-L2668)

## 配置错误处理

系统在处理节假日配置时包含了错误处理机制。当从 `config/holidays.json` 文件加载配置时，使用了 `fetch` 和 `catch` 方法来处理可能的网络或解析错误。如果加载失败，系统会初始化空的节假日配置对象。

在用户界面操作中，当用户尝试导入节假日配置时，系统使用 `try-catch` 语句来捕获JSON解析错误。如果解析失败，系统会显示“JSON 格式错误”的提示，防止无效配置被应用到系统中。

此外，系统在合并官方节假日配置到日历时，会对日期字符串进行解析和验证，确保只有格式正确的日期才会被处理。这种多层次的错误处理机制确保了系统的稳定性和数据的完整性。

**Section sources**
- [script.js](file://script.js#L1287-L1294)
- [script.js](file://script.js#L2646-L2656)
- [script.js](file://script.js#L1301-L1304)