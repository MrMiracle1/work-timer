# Work Timer 开发日志

## 版本记录表

| 版本号 | 发布日期 | 更新内容 | 负责人 | 备注 |
|--------|----------|----------|--------|------|
| 1.2.0 | 2025-11-14 | - 菜单抽屉入口优化<br>- 假期倒计时同步修复<br>- 金币特效优化<br>- 接入DeepSeek AI模块<br>- 实现上下班打卡功能 | 开发团队 | AI功能版本 |
| 1.1.0 | 2025-11-14 | - 实现左侧菜单抽屉架构<br>- 优化下班倒计时逻辑<br>- 增加边界显示处理<br>- 修复发薪倒计时准确性<br>- 实现工资进度点击动画<br>- 新增番茄钟功能<br>- 扩展日历标签功能 | 开发团队 | 重大更新 |
| 1.0.4 | 2025-11-13 | - 修复本周剩余工作时间显示格式问题<br>- 优化时间显示逻辑，确保显示小时和分钟<br>- 完善时间计算准确性 | 开发团队 | 修复版本 |
| 1.0.3 | 2025-11-13 | - 修复本周剩余工作时间计算错误问题<br>- 优化周末事件计算逻辑，正确处理今天剩余工作时间<br>- 改进工作日剩余时间计算准确性 | 开发团队 | 修复版本 |
| 1.0.2 | 2025-11-13 | - 增加午休时间设置功能，支持午休开始时间和午休结束时间设置<br>- 实现午休时间不算作工作时间的逻辑<br>- 更新本周剩余工作时间计算，正确扣除午休时间<br>- 完善时间设置验证逻辑，确保时间顺序合理性<br>- 修改下班倒计时计算，考虑午休时间段<br>- 优化午餐时间倒计时显示 | 开发团队 | 功能增强版本 |
| 1.0.1 | 2025-11-13 | - 修复"本周剩余工作时间"计算逻辑，正确计算到本周五下班时间为止，而不是到周六<br>- 优化周末时间计算算法，符合中国常规工作制度 | 开发团队 | 修复版本 |
| 1.0.0 | 2025-11-13 | - 完成基础倒计时功能开发<br>- 实现下班时间、周末、发薪日倒计时<br>- 完成日历模块开发<br>- 实现工资进度条功能<br>- 完成设置模块开发<br>- 实现响应式设计<br>- 完成首次设置引导流程<br>- 实现本地数据存储 | 开发团队 | 初始版本 |

## 详细更新记录

### v1.2.0 (2025-11-14)

#### 功能增强
1. **菜单按钮位置优化**
   - 将菜单按钮从顶部卡片移至页面左上角
   - 固定定位设计，不受页面滚动影响
   - 增加悬停特效，提升交互体验

2. **假期倒计时同步修复**
   - 修复假期倒计时与配置文件不同步问题
   - 优先从 localStorage 读取 officialHolidays 配置
   - 确保倒计时内容严格依据配置文件
   - 配置为空时才使用默认节假日

3. **工资进度交互优化**
   - 点击整个工资进度卡片触发金币动画（不仅限于进度条）
   - 增加 Toast 提示："摸鱼1s"
   - 提升交互范围和用户反馈

4. **DeepSeek AI 模块接入**
   - 实现 DeepSeek API 调用封装
   - 支持用户在设置页配置 API 密钥
   - 提供 API 连接测试功能
   - 支持密钥显示/隐藏切换
   - 实现兰底机制，调用失败时显示预设文案

5. **上下班打卡功能**
   - 在倒计时页面顶部增加打卡按钮
   - 按钮文案智能切换（上班打卡/下班打卡）
   - 打卡后弹窗显示 AI 生成的问候语
   - 10秒倒计时自动关闭弹窗
   - 支持点击弹窗外部关闭
   - AI 调用失败时显示兰底文案和错误提示

6. **Prompt 配置文件**
   - 创建 prompts.js 统一管理 AI 提示词
   - 定义上班打卡和下班打卡的 Prompt
   - 定义兰底文案库，提供多条随机文案

#### 技术实现
1. **AI 模块封装**
   - 实现 callDeepSeekAPI 函数调用 DeepSeek API
   - 实现 getAIGreeting 函数获取 AI 问候语
   - 支持 async/await 异步调用
   - 实现错误处理和兰底机制

2. **UI/UX 优化**
   - 菜单按钮采用固定定位 + 渐变背景色
   - 打卡弹窗采用居中布局 + 圆角设计
   - Toast 提示采用固定底部位置 + 渐隐动画
   - 打卡按钮动态更新文案，根据时间和上次打卡状态判断

3. **数据存储**
   - localStorage 存储 deepseekApiKey
   - localStorage 存储 lastClockInType 记录上次打卡类型

4. **算法优化**
   - 优化 addHolidays 函数，优先读取配置文件
   - 实现智能打卡按钮文案切换逻辑

#### 用户体验
1. **交互优化**
   - 菜单按钮位置更加合理，不影响主内容区
   - 打卡功能提供 AI 智能问候，增加趣味性
   - 工资进度点击区域扩大，操作更加便捷

2. **功能增强**
   - AI 功能提供个性化问候语
   - 假期倒计时更加准确，与配置同步
   - Toast 提示增加反馈及时性

#### 问题修复
1. **菜单按钮位置问题**
   - 原因：菜单按钮在顶部卡片中，占用空间
   - 修复：移至页面左上角固定定位

2. **假期倒计时同步问题**
   - 原因：假期倒计时使用硬编码，未读取配置
   - 修复：修改 addHolidays 函数，优先读取 localStorage 配置

3. **金币特效触发区域小**
   - 原因：仅在进度条上点击触发
   -优化：扩大至整个工资进度卡片

#### 数据管理
1. **localStorage 优化**
   - 新增 deepseekApiKey 存储 AI API 密钥
   - 新增 lastClockInType 记录打卡状态
   - 保持数据结构的向后兼容性

### v1.1.0 (2025-11-14)

#### 功能增强
1. **左侧菜单抽屉架构**
   - 实现左侧抽屉式菜单导航
   - 支持响应式设计，手机版和电脑版交互逻辑一致
   - 增加遮罩层和平滑动画效果
   - 移除顶部标签导航，采用侧边栏主导航模式

2. **下班倒计时优化**
   - 直接计算到下班时间的剩余时间，不扣除午休时间
   - 增加时间边界处理：早于上班或晚于下班显示"下班啦！"
   - 简化计算逻辑，提高性能

3. **卡片边界显示优化**
   - 本周剩余工作时间为0或负数时显示"周末啦！"
   - 发薪倒计时为0或负数时显示"发钱啦！"
   - 提升用户体验，更加直观

4. **发薪倒计时准确性修正**
   - 修复当前计数比实际少1天的问题
   - 调整计算基准：从发薪日0点改为发薪日24点（即第二天0点）
   - 支持每月最后一天类型的发薪日

5. **工资进度交互增强**
   - 点击工资进度卡片触发金币+1动画特效
   - 动画效果流畅，视觉反馈明确
   - 提升交互趣味性

6. **番茄钟功能**
   - 在倒计时页面增加番茄钟入口
   - 以模态窗口形式展现，页面背景添加黑色半透明蒙层
   - 支持自定义专注时长（1-120分钟）
   - 提供快捷选项：15/30/45/60分钟
   - 支持中途取消操作
   - 倒计时结束显示完成提示

7. **日历标签功能扩展**
   - 新增发薪日标识（蓝色标签）
   - 自动标识固定日期和月末最后一天类型
   - 增加日历图例说明

#### 技术实现
1. **UI/UX优化**
   - CSS左侧抽屉实现，支持平滑滑出/收起
   - 金币动画使用CSS @keyframes实现
   - 番茄钟模态窗口采用居中布局，背景遮罩禁用页面操作

2. **算法优化**
   - 简化下班倒计时计算逻辑，直接计算剩余时间
   - 修正发薪日计算基准时间
   - 增加时间边界检查逻辑

3. **交互优化**
   - 侧边栏点击导航后自动关闭
   - 番茄钟倒计时实时更新
   - 工资进度点击反馈及时

#### 用户体验
1. **导航优化**
   - 采用现代化的侧边栏导航模式
   - 支持手机端和桌面端统一交互
   - 视觉反馈清晰，操作流畅

2. **功能增强**
   - 番茄钟功能为用户提供时间管理工具
   - 边界显示更加人性化
   - 交互动画提升趣味性

#### 问题修复
1. **发薪倒计时-1天问题**
   - 原因：计算基准为发薪日0点
   - 修复：调整为发薪日24点（第二天0点）

2. **下班倒计时复杂性**
   - 原因：复杂的午休时间扣除逻辑
   - 优化：简化为直接计算到下班时间

#### 数据管理
1. **localStorage优化**
   - 新增番茄钟相关的时间记录
   - 保持数据结构的向后兼容性

### v1.0.4 (2025-11-13)

#### 问题修复
1. **本周剩余工作时间显示格式修复**
   - 修复了主界面本周剩余工作时间显示格式不正确的问题
   - 优化了时间显示逻辑，确保显示小时和分钟格式（如"10小时8分钟"）
   - 完善了时间计算和显示的一致性

#### 技术实现
1. **显示优化**
   - 修改了周末事件时间显示逻辑，直接使用小时和分钟值进行显示
   - 避免了formatTimeRemaining函数对显示格式的自动调整

### v1.0.3 (2025-11-13)

#### 问题修复
1. **本周剩余工作时间计算错误修复**
   - 修复了主界面本周剩余工作时间计算不准确的问题
   - 优化了周末事件计算逻辑，正确处理今天剩余工作时间
   - 改进了工作日剩余时间计算准确性，确保与工具计算结果一致

#### 技术实现
1. **算法优化**
   - 重新设计了周末倒计时计算逻辑中的当天工作时间计算
   - 精确计算当前时间到下班时间的剩余工作时长
   - 考虑了上午工作时间、午休时间和下午工作时间的不同情况

### v1.0.2 (2025-11-13)

#### 功能增强
1. **午休时间设置功能**
   - 在首次设置和用户设置中增加午休开始时间和午休结束时间设置项
   - 实现午休时间不算作工作时间的逻辑
   - 添加时间设置验证，确保上班时间 < 午休开始时间 < 午休结束时间 < 下班时间

2. **工作时间计算优化**
   - 更新本周剩余工作时间计算逻辑，正确扣除午休时间
   - 修改下班倒计时计算，考虑午休时间段
   - 优化午餐时间倒计时显示，使用用户设置的午休开始时间

3. **用户体验改进**
   - 完善时间设置验证逻辑，提供明确的错误提示
   - 保持界面整洁，不影响原有功能布局

#### 技术实现
1. **数据存储**
   - 新增lunchStartTime和lunchEndTime本地存储字段
   - 更新workTimeConfig结构，包含午休时间配置

2. **算法优化**
   - 重新设计工作时间计算逻辑，精确处理午休时间段
   - 优化倒计时计算函数，考虑上午工作时间、午休时间和下午工作时间

### v1.0.1 (2025-11-13)

#### 问题修复
1. **周末倒计时计算逻辑修复**
   - 修复了"本周剩余工作时间"计算错误的问题
   - 原逻辑计算到周六的剩余工作时间，现已修正为计算到本周五下班时间
   - 符合中国常规工作制度（周一至周五上班，周五下班后即为休息时间）
   - 优化了周末时间计算算法，提高准确性

#### 技术实现
1. **算法优化**
   - 重新设计了周末倒计时计算逻辑
   - 精确计算从当前时间到本周五下班时间的工作时长
   - 考虑了节假日和工作日的区分
   - 处理了跨周末的时间计算边界情况

### v1.0.0 (2025-11-13)

#### 功能特性
1. **倒计时模块**
   - 实现下班倒计时功能，精确到秒显示
   - 实现周末倒计时功能，显示本周剩余工作时间
   - 实现发薪日倒计时功能，支持固定日期和月末最后一天两种模式
   - 实现期待时间倒计时功能，智能显示午饭时间或最近假期
   - 实现其他法定节假日倒计时功能

2. **工资进度模块**
   - 实现工资进度条可视化展示
   - 实现进度百分比文本显示
   - 实现进度实时更新功能

3. **日历模块**
   - 实现月份切换功能
   - 实现日期类型标识（工作日、周末、公休假期、串休上班日、自定义假期）
   - 实现日期交互功能，点击可切换日期类型
   - 实现图例说明功能

4. **设置模块**
   - 实现工作时间设置功能
   - 实现发薪日设置功能
   - 实现开发者设置功能（自定义时间模式、缓存清除）
   - 实现自定义事件管理功能

5. **首次设置模块**
   - 实现首次使用引导流程
   - 实现初始配置保存功能

#### 技术实现
1. **前端技术**
   - 使用原生HTML、CSS、JavaScript实现
   - 无第三方框架依赖
   - 使用localStorage进行本地数据存储

2. **响应式设计**
   - 实现桌面端多列布局
   - 实现移动端单列布局和底部导航
   - 实现触屏友好的交互设计

3. **性能优化**
   - 实现定时器优化，每秒更新一次
   - 实现DOM操作优化
   - 实现事件监听器管理

#### 用户体验
1. **交互设计**
   - 实现标签页导航切换
   - 实现Toast提示反馈
   - 实现模态框设置界面
   - 实现卡片hover效果

2. **视觉设计**
   - 实现统一色彩体系
   - 实现圆角和阴影设计
   - 实现清晰的字体规范
   - 实现直观的图标标识

#### 数据管理
1. **本地存储**
   - 实现用户设置持久化存储
   - 实现自定义事件数据存储
   - 实现假期类型配置存储
   - 实现开发者模式设置存储

#### 测试验证
1. **功能测试**
   - 完成所有核心功能测试
   - 完成交互流程测试
   - 完成数据存储测试

2. **兼容性测试**
   - 完成主流浏览器兼容性测试
   - 完成移动端适配测试
   - 完成不同分辨率适配测试

3. **性能测试**
   - 完成页面加载性能测试
   - 完成定时器更新性能测试
   - 完成内存使用测试
## 2025-11-13
- 日历样式与交互升级：比例优化、状态色与标签、图例完善。
- 法定节假日配置引入 `config/holidays.json`，支持导入/重置/导出与本地持久化。
- 修复 PC 端日历月份切换事件绑定，改用按钮克隆重绑策略避免重复监听问题。
- 倒计时卡片添加悬停提示，展示计算过程与关键参数。
